<!--templates/schedule.html-->
{% extends "layout.html" %}

{% block title %}èª²ç¨‹æ™‚é–“è¨­å®š{% endblock %}

{% block content %}
<h3 class="mb-4">è¨­å®šä½ çš„èª²ç¨‹æ™‚é–“ï¼ˆå‹¾é¸å¾Œè‡ªå‹•å„²å­˜ï¼‰</h3>

<div class="row">
    {% set weekdays = ['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'] %}
    {% set periods = ['0','1','2','3','4','5','6','7','8','9','10','A','B','C','D'] %}
    {% for i in range(7) %}
        <div class="col-md-6 mb-3">
            <strong>æ˜ŸæœŸ{{ weekdays[i] }}</strong><br>
            {% for p in periods %}
                {% set value = i ~ '_' ~ p %}
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="timeslot" value="{{ value }}" id="{{ value }}"
                    {% if value in selected_slots %}checked{% endif %}>
                    <label class="form-check-label" for="{{ value }}">{{ p }}</label>
                </div>
            {% endfor %}
        </div>
    {% endfor %}
</div>

<div id="save-status" class="mt-3 text-success" style="display:none;">âœ… å·²è‡ªå‹•å„²å­˜</div>
{% endblock %}
{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    console.log("ğŸ§ª schedule.html çš„ script æˆåŠŸåŸ·è¡Œï¼");

    const checkboxes = document.querySelectorAll('input[type="checkbox"][name="timeslot"]');
    const statusEl = document.getElementById("save-status");

    console.log("ğŸ§ª å·²è¼‰å…¥ checkbox æ•¸é‡:", checkboxes.length);

    checkboxes.forEach(cb => {
        cb.addEventListener("change", function () {
            console.log("âœ… è¢«æ”¹å‹•çš„:", this.value);

            const selected = Array.from(checkboxes)
                                  .filter(c => c.checked)
                                  .map(c => c.value);

            console.log("ğŸ“¦ å°‡é€å‡ºçš„ slots:", selected);

            fetch("/save_schedule", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ slots: selected })
            })
            .then(res => res.json())
            .then(data => {
                console.log("âœ… å›æ‡‰:", data);
                if (data.success) {
                    statusEl.style.display = "block";
                    setTimeout(() => { statusEl.style.display = "none"; }, 1500);
                } else {
                    alert("å„²å­˜å¤±æ•—");
                }
            })
            .catch(() => {
                alert("é€£ç·šéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
            });
        });
    });
});
</script>
{% endblock %}



